<!-- Displaying Calendar with Events -->
<%= month_calendar events: @events do |date, events| %>
  <%= date %>
    <% events.each do |event| %>
    <div>
      <%= link_to event.title, event.url %> on <%= event.time.localtime.strftime('%a %d %b') %> @ <%= event.time.localtime.strftime('%I:%M %p') %>
    </div>
  <% end %>
<% end %>

<br /><br />

<!-- Search Bar -->
<input type="text" id="search" name="search" placeholder="Search"></text>
<i class="fa fa-search" aria-hidden="true"></i>

<!-- Event List: Load all but only show top 3 -->
<ul id="event-list">
  <% @events.each_with_index do |event, index| %>
  <% if index < 3 %>
    <li class='event-listing'>
      <%= "#{event.title} on #{event.time.asctime[0..15]}" %>
      <!-- TODO: Can we strip this better? -->
    </li>
    <% else %>
    <li class='event-listing' style="display:none">
      <%= "#{event.title} on #{event.time.asctime[0..15]}" %>
    </li>
    <% end %>
  <% end %>
</ul>

<!-- Search Filter Function -->
<script>
var filter = function() {
  $("#search").on("keyup", function() {
    var filter = $('#search').val();
    if ($('#search').val()==="") {
      $('#event-list li').hide();
      // TODO: hide bullets in css file
      for (var i = 1; i < 4; i++) {
        $('#event-list > li:nth-child(' + i + ')').show();
      }
    } else {
      $("#event-list li").each(function() {
        // TODO: Can we restrict this to top 3 as well
        if ($(this).text().search(new RegExp(filter, "i")) < 0) {
          $(this).fadeOut();
        } else {
          $(this).show();
        }
      })
    }
  });
};
filter();
</script>
